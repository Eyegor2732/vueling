package com.vueling.pageactions;

import java.util.Iterator;
import java.util.List;
import java.util.Set;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

import com.vueling.pageobjects.BookPageObjects;

public class BookPageActions extends BookPageObjects{
	
	WebDriver driver;

	public BookPageActions(WebDriver driver) {
		super(driver);
		this.driver = driver;
	}

	public void goTo() {
		driver.get("https://www.vueling.com/en");
	}
	
	private void popupDropdownSelect(String result) {
		for (WebElement element : popupDropdown) {
			if(element.getText().split(",")[0].equalsIgnoreCase(result)) {
				element.click();
				break;
			};
		}
	}
	
	private void calendarTwoWaySwitch() {
		if (calendarSwitchButton.getAttribute("aria-pressed").equals("false")) {
			calendarSwitchButton.click();
		}
	}
	
	public void addAdults(String adultPassengers) {
		int i = 1;
		while (Integer.parseInt(adultCounter.getText()) < Integer.parseInt(adultPassengers)) {
			adultAddButton.click();
			i++;
		}
	}
	
	public SchedulePageActions selectFlight(String originSearch, String originResult, String destinationResult, String adultPassengers) throws InterruptedException {

		originInput.click();
		originInput.sendKeys(originSearch);	
		popupDropdownSelect(originResult);
		popupDropdownSelect(destinationResult);
		calendarTwoWaySwitch();
		Thread.sleep(1000);
		originMonth.click();
		Thread.sleep(1000);
		returnMonth.click();
		passengrersInput.click();
		addAdults(adultPassengers);
		searchButton.click();
		searchButton.click();
		
//		Set<String> windowHandles = driver.getWindowHandles();
//		Iterator<String> it = windowHandles.iterator();
//		String parentHandle = it.next();
//		String childHandle = it.next();	
//		driver.switchTo().window(childHandle);
		
//		waitForURL("https://global.vueling.com/en/search?origins=", 5);
//		System.out.println("ma " + driver.getTitle());
		
		return (new SchedulePageActions(driver));
	}

}