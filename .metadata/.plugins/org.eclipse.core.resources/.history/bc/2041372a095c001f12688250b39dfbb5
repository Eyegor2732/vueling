package com.vueling.pageactions;

import java.util.Iterator;
import java.util.List;
import java.util.Set;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

import com.vueling.pageobjects.MainPageObjects;

public class MainPageActions extends MainPageObjects{
	
	WebDriver driver;

	public MainPageActions(WebDriver driver) {
		super(driver);
		this.driver = driver;
	}

	public void goTo() {
		driver.get("https://www.vueling.com/en");
	}
	
	private void popupDropdownSelect(String result) {
		for (WebElement element : popupDropdown) {
			if(element.getText().split(",")[0].equalsIgnoreCase(result)) {
				element.click();
				break;
			};
		}
	}
	
	private void calendarTwoWaySwitch() {
		if (calendarSwitchButton.getAttribute("aria-pressed").equals("false")) {
			calendarSwitchButton.click();
		}
	}
	
	public void addAdults(String adultPassengers) {
		int i = 1;
		System.out.println(Integer.parseInt(adultCounter.getText()));
		System.out.println(Integer.parseInt(adultPassengers));
		while (Integer.parseInt(adultCounter.getText()) < Integer.parseInt(adultPassengers)) {
			adultAddButton.click();
			i++;
		}
	}
	
	public SchedulePageActions selectFlight(String originSearch, String originResult, String destinationResult, String adultPassengers) throws InterruptedException {
		acceptCookiesButton.click();
		originInput.click();
		originInput.sendKeys(originSearch);
		globalSwitchButton.click();	
		popupDropdownSelect(originResult);
		popupDropdownSelect(destinationResult);
		calendarTwoWaySwitch();
		waitForElementToAppear(availableDatesLocator, 5);
		availableDates.get(0).click();
		passengrersInput.click();
		addAdults(adultPassengers);
		searchButton.click();
		Set<String> windowHandles = driver.getWindowHandles();
		Iterator<String> it = windowHandles.iterator();
		String parentHandle = it.next();
		String childHandle = it.next();	
		String grandchildHandle = it.next();
		driver.switchTo().window(grandchildHandle);
		System.out.println(driver.getTitle());
		return (new SchedulePageActions(driver));
	}

}